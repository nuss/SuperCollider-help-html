<!doctype html><html lang='en'><head><title>Encoding FOA | SuperCollider 3.12.1 Help</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../editor.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../lib/jquery.min.js'></script>
<script src='./../lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'Encoding FOA';
var scdoc_sc_version = '3.12.1';
</script>
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>Encoding FOA:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#Authoring'>Authoring</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#Choose%20a%20decoder'>Choose a decoder</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#Mono'>Mono</a></li>
<ul class='toc'><li class='toc2'><a href='#Omni%20&%20Push'>Omni &amp; Push</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Frequency%20spreading%20&%20Push'>Frequency spreading &amp; Push</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Frequency%20diffusion%20&%20Push'>Frequency diffusion &amp; Push</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#Stereo'>Stereo</a></li>
<ul class='toc'><li class='toc2'><a href='#Pan2,%20Stereo%20matrix%20&%20Zoom'>Pan2, Stereo matrix &amp; Zoom</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Stereo%20matrix'>Stereo matrix</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Super%20Stereo'>Super Stereo</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ambisonic%20UHJ%20stereo'>Ambisonic UHJ stereo</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#Tetrahedral,%20aka%20A-format'>Tetrahedral, aka A-format</a></li>
<ul class='toc'><li class='toc2'><a href='#Diffuse%20field%20&%20Push'>Diffuse field &amp; Push</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Spaced%20microphones'>Spaced microphones</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#2D%20&%203D%20surround'>2D &amp; 3D surround</a></li>
<ul class='toc'><li class='toc2'><a href='#Octophonic'>Octophonic</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Dome'>Dome</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#2D%20ZoomH2'>2D ZoomH2</a></li>
<ul class='toc'><li class='toc2'><a href='#ZoomH2,%20forward'>ZoomH2, forward</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#ZoomH2,%20reversed'>ZoomH2, reversed</a></li>
<ul class='toc'></ul></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Guides (extension)</span>
 | <span id='categories'><a href='./../Browse.html#Libraries'>Libraries</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit'>Ambisonic Toolkit</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit>Guides & Tutorials'>Guides & Tutorials</a></span>
</div><h1>Encoding FOA<div class='extension-indicator-ctr' title='This help file originates from a third-party quark or plugin for SuperCollider.'><img class='extension-indicator-icon' alt='Extension' src='./../images/plugin.png'><span class='extension-indicator-text'>Extension</span></div></h1>
<div id='summary'>First Order Ambisonic (FOA) encoding examples</div>
</div>
<div class='subheader'>
</div>
<a class='anchor' name='kw_Atk'>&nbsp;</a><h2><a class='anchor' name='Authoring'>Authoring</a></h2>

<p>Most users approaching Ambisonics are usually presented with two avenues to author an Ambisonic soundfield: capture a natural soundfield directly with a Soundfield microphone, <a class='footnote anchor' name='footnote_org_1' href='#footnote_1'><sup>1</sup></a>  or author a planewave from a monophonic signal.<a class='footnote anchor' name='footnote_org_2' href='#footnote_2'><sup>2</sup></a>  SuperCollider's inbuilt <a href="./../Classes/PanB.html">PanB</a> provides the latter solution.
<p>The ATK provides a much wider palate of authoring tools via <a href="./../Classes/FoaEncode.html">FoaEncode</a>. These include:<ul>
<li><em>planewave:</em> aka basic directional encoding<li><em>omnidirectional:</em> a soundfield from everywhere<li><em>virtual loudspeaker array:</em> transcoding standard formats<li><em>pseudoinverse microphone array:</em> encoding from discrete microphones or signals</ul>

<p>In combination with the ATK's <a href="./../Guides/Transforming-FOA.html">imaging tools</a>, sound images can then be compositionally controlled as required.
<p>The examples below are intended to briefly illustrate some of the first order encoding options made available in the Ambisonic Toolkit.<div class='note'><span class='notelabel'>NOTE:</span> See <a href="./../Classes/FoaEncode.html">FoaEncode</a>, <a href="./../Classes/FoaEncoderMatrix.html">FoaEncoderMatrix</a> and <a href="./../Classes/FoaEncoderKernel.html">FoaEncoderKernel</a> for more details regarding FOA encoding.</div><h2><a class='anchor' name='Choose%20a%20decoder'>Choose a decoder</a></h2>

<p>As the Ambisonic technique is a hierarchal system, numerous options for playback are possible. These include two channel stereo, two channel binaural, pantophonic and full 3D periphonic. With the examples below, we'll take advantage of this by first choosing a suitable decoder with with to audition.
<p>Choose a decoder suitable for your system, as illustrated <a href="./../Guides/Intro-FOA-Examples.html#Choose%20a%20decoder">here</a>. You'll end up definining <code>~decoder</code> and <code>~renderDecode</code> .<div class='note'><span class='notelabel'>NOTE:</span> If you choose a kernel decoder, <a href="./../Classes/FoaDecoderKernel.html">FoaDecoderKernel</a>, be sure to free the kernel after use.</div><h2><a class='anchor' name='Mono'>Mono</a></h2>

<p>We have many choices to make when encoding a mono source. These examples include following an encoder with a transformer.<h3><a class='anchor' name='Omni%20&%20Push'>Omni &amp; Push</a></h3>

<p>Encoded as an omnidirectional soundfield (no space!), <a href="./../Classes/PinkNoise.html">PinkNoise</a> is used as the example sound source.
<p>In a well aligned, dampend studio environment, this usually sounds "in the head". <a href="./../Classes/FoaPush.html">FoaPush</a> is used to "push" the omnidirectional soundfield so that it becomes a planewave (infinite distance, in an anechoic environment) arriving from some direction.
<p>The soundfield is controlled by <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a>, where <a href="./../Classes/MouseX.html">MouseX</a> specifies the incident azimuth angle (pi to -pi; left to right of display) and <a href="./../Classes/MouseY.html">MouseY</a> the <a href="./../Classes/FoaPush.html">FoaPush</a> angle (0 to pi/2; bottom to top of display). With the mouse at the bottom of the display, the soundfield remains omnidirectional. Placed at the top of the display, the soundfield becomes directional, and varying left/right position will vary the incident azimuth of the resulting planewave.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newOmni">FoaEncoderMatrix: *newOmni</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// omni encoder
// mono pink noise source


// define encoder matrix
~encoder = FoaEncoderMatrix.newOmni

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels

(
{
    var sig;                            // audio signal
    var angle, azim;                    // angle and azimuth control


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // angle ---&gt; top           = push to plane wave
    //            bottom        = omni-directional
    angle = MouseY.kr(pi/2, 0);

    // azimuth -&gt; hard left     = back
    //            centre        = centre
    //            hard right    = back
    azim = MouseX.kr(pi, -pi);

    // ------------------------------------------------------------
    // test sig
    sig = PinkNoise.ar;                         // mono pink noise


    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);

    // ------------------------------------------------------------
    // transform
    sig = FoaTransform.ar(sig, 'push', angle, azim);



    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)
// ------------------------------------------------------------</textarea>
<h3><a class='anchor' name='Frequency%20spreading%20&%20Push'>Frequency spreading &amp; Push</a></h3>

<p>Encoded as a frequency spread soundfield, <a href="./../Classes/PinkNoise.html">PinkNoise</a> is used as the example sound source. This sounds as spread across the soundfield, with the various frequency components appearing in various places. <a href="./../Classes/FoaPush.html">FoaPush</a> is used to "push" the omnidirectional soundfield so that it becomes a planewave (infinite distance, in an anechoic environment) arriving from some direction.
<p>The soundfield is controlled by <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a>, where <a href="./../Classes/MouseX.html">MouseX</a> specifies the incident azimuth angle (pi to -pi; left to right of display) and <a href="./../Classes/MouseY.html">MouseY</a> the <a href="./../Classes/FoaPush.html">FoaPush</a> angle (0 to pi/2; bottom to top of display). With the mouse at the bottom of the display, the soundfield remains spread. Placed at the top of the display, the soundfield becomes directional, and varying left/right position will vary the incident azimuth of the resulting planewave.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A kernel type encoder, see <a href="./../Classes/FoaEncoderKernel.html#*newSpread">FoaEncoderKernel: *newSpread</a> for further details.</div><div class='warning'><span class='warninglabel'>WARNING:</span> Kernel encoders require special care. Allow the kernel time to load before attempting to use. Additionally, the kernel buffer should be freed through the use of <a href="./../Classes/FoaEncoderKernel.html#-free">FoaEncoderKernel: -free</a> after use.</div><textarea class='editor'>// ------------------------------------------------------------
// frequency spreading encoder
// mono pink noise source


// define encoder kernel
~encoder = FoaEncoderKernel.newSpread

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels

(
{
    var sig;                            // audio signal
    var angle, azim;                    // angle and azimuth control


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // angle ---&gt; top           = push to plane wave
    //            bottom        = omni-directional
    angle = MouseY.kr(pi/2, 0);

    // azimuth -&gt; hard left     = back
    //            centre        = centre
    //            hard right    = back
    azim = MouseX.kr(pi, -pi);

    // ------------------------------------------------------------
    // test sig
    sig = PinkNoise.ar;                         // mono pink noise


    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);

    // ------------------------------------------------------------
    // transform
    sig = FoaTransform.ar(sig, 'push', angle, azim);



    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)
// ------------------------------------------------------------

// free kernel
~encoder.free</textarea>
<h3><a class='anchor' name='Frequency%20diffusion%20&%20Push'>Frequency diffusion &amp; Push</a></h3>

<p>Encoded as a frequency diffused soundfield, <a href="./../Classes/PinkNoise.html">PinkNoise</a> is used as the example sound source. This sounds as diffused across the soundfield, with the various frequency components appearing in various places, with various phases. <a href="./../Classes/FoaPush.html">FoaPush</a> is used to "push" the omnidirectional soundfield so that it becomes a planewave (infinite distance, in an anechoic environment) arriving from some direction.
<p>The soundfield is controlled by <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a>, where <a href="./../Classes/MouseX.html">MouseX</a> specifies the incident azimuth angle (pi to -pi; left to right of display) and <a href="./../Classes/MouseY.html">MouseY</a> the <a href="./../Classes/FoaPush.html">FoaPush</a> angle (0 to pi/2; bottom to top of display). With the mouse at the bottom of the display, the soundfield remains spread. Placed at the top of the display, the soundfield becomes directional, and varying left/right position will vary the incident azimuth of the resulting planewave.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A kernel type encoder, see <a href="./../Classes/FoaEncoderKernel.html#*newDiffuse">FoaEncoderKernel: *newDiffuse</a> for further details.</div><div class='warning'><span class='warninglabel'>WARNING:</span> Kernel encoders require special care. Allow the kernel time to load before attempting to use. Additionally, the kernel buffer should be freed through the use of <a href="./../Classes/FoaEncoderKernel.html#-free">FoaEncoderKernel: -free</a> after use.</div><textarea class='editor'>// ------------------------------------------------------------
// frequency diffusion encoder
// mono pink noise source


// define encoder kernel
~encoder = FoaEncoderKernel.newDiffuse

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels

(
{
    var sig;                            // audio signal
    var angle, azim;                    // angle and azimuth control


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // angle ---&gt; top           = push to plane wave
    //            bottom        = omni-directional
    angle = MouseY.kr(pi/2, 0);

    // azimuth -&gt; hard left     = back
    //            centre        = centre
    //            hard right    = back
    azim = MouseX.kr(pi, -pi);

    // ------------------------------------------------------------
    // test sig
    sig = PinkNoise.ar;                         // mono pink noise


    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);

    // ------------------------------------------------------------
    // transform
    sig = FoaTransform.ar(sig, 'push', angle, azim);



    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)
// ------------------------------------------------------------

// free kernel
~encoder.free</textarea>
<h2><a class='anchor' name='Stereo'>Stereo</a></h2>

<p>As with <a href="#Mono">mono</a> sources, we have numerous options when encoding stereo sources. Here are a few.<h3><a class='anchor' name='Pan2,%20Stereo%20matrix%20&%20Zoom'>Pan2, Stereo matrix &amp; Zoom</a></h3>

<p>In this example we first encode a single channel of <a href="./../Classes/PinkNoise.html">PinkNoise</a> into a stereophonic signal with <a href="./../Classes/Pan2.html">Pan2</a>. <a href="./../Classes/FoaZoom.html">FoaZoom</a> is then used to balance the soundfield across the x-axis (front/back).
<p>The soundfield is controlled by <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a>, where <a href="./../Classes/MouseX.html">MouseX</a> specifies the left to right position of the stereo panned source and <a href="./../Classes/MouseY.html">MouseY</a> the <a href="./../Classes/FoaZoom.html">FoaZoom</a> front to back position (distortion angle). Moving the mouse in a circular motion results in a circular motion of the sound.<a class='footnote anchor' name='footnote_org_3' href='#footnote_3'><sup>3</sup></a> 
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newStereo">FoaEncoderMatrix: *newStereo</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// stereo encoder
// stereo panned mono pink noise source


// define encoder matrix
~encoder = FoaEncoderMatrix.newStereo


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg

(
{
    var sig;                            // audio signal
    var angle, azim;                    // angle and azimuth control


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // angle ---&gt; top           = zoom to plane wave at front
    //            bottom        = zoom to plane wave at back
    angle = MouseY.kr(pi/2, pi.neg/2);

    // azimuth -&gt; hard left     = back
    //            centre        = centre
    //            hard right    = back
    azim = MouseX.kr(pi, -pi);

    // ------------------------------------------------------------
    // test sig
    sig = PinkNoise.ar;                                 // mono pink noise

    // ------------------------------------------------------------
    // pan (encode) to stereo
    sig = Pan2.ar(sig, azim.neg/pi);

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);

    // ------------------------------------------------------------
    // transform
    sig = FoaTransform.ar(sig, 'zoom', angle);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free kernel
~encoder.free

// ------------------------------------------------------------</textarea>
<h3><a class='anchor' name='Stereo%20matrix'>Stereo matrix</a></h3>

<p>For this example we'll look at encoding stereo soundfiles.
<p>The stereo encoder places the left channel at +pi/4 and the right at -pi/4. Compare to the <a href="./../Classes/FoaEncoderKernel.html#*newSuper">Super Stereo</a> encoder <a href="#Super%20Stereo%20encoder%20(soundfile)">below</a>.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newStereo">FoaEncoderMatrix: *newStereo</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// stereo encoder
// stereo soundfile read from disk


// define encoder matrix
~encoder = FoaEncoderMatrix.newStereo(pi/4)


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/The_City_Waites-The_Downfall.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/The_City_Waites-An_Old.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/Aurora_Surgit-Lux_Aeterna.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/Aurora_Surgit-Dies_Irae.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>The City Waites, "The Downfall of Dancing," Penny Merriments, NAXOS 8.557672<li>The City Waites, "An Old Song on the Spanish Armada," Penny Merriments, NAXOS 8.557672<li>Aurora Surgit, "Lux aeterna," Ego sum Resurrectio, NAXOS 8.557672<li>Aurora Surgit, "Dies irae," Ego sum Resurrectio, NAXOS 8.557672</ul>
</div><h3><a class='anchor' name='Super%20Stereo'>Super Stereo</a></h3>

<p>Super Stereo<a class='footnote anchor' name='footnote_org_4' href='#footnote_4'><sup>4</sup></a>  is the classic Ambisonic method to encode stereophonic files, and is considered to be optimal for frontal stereo encoding.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A kernel type encoder, see <a href="./../Classes/FoaEncoderKernel.html#*newSuper">FoaEncoderKernel: *newSuper</a> for further details.</div><div class='warning'><span class='warninglabel'>WARNING:</span> Kernel encoders require special care. Allow the kernel time to load before attempting to use. Additionally, the kernel buffer should be freed through the use of <a href="./../Classes/FoaEncoderKernel.html#-free">FoaEncoderKernel: -free</a> after use.</div><textarea class='editor'>// ------------------------------------------------------------
// super stereo encoder
// stereo soundfile read from disk


// define encoder matrix
~encoder = FoaEncoderKernel.newSuper


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/The_City_Waites-The_Downfall.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/The_City_Waites-An_Old.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/Aurora_Surgit-Lux_Aeterna.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/stereo/Aurora_Surgit-Dies_Irae.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free kernel &amp; buffer
~encoder.free
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>The City Waites, "The Downfall of Dancing," Penny Merriments, NAXOS 8.557672<li>The City Waites, "An Old Song on the Spanish Armada," Penny Merriments, NAXOS 8.557672<li>Aurora Surgit, "Lux aeterna," Ego sum Resurrectio, NAXOS 8.557672<li>Aurora Surgit, "Dies irae," Ego sum Resurrectio, NAXOS 8.557672</ul>
</div><h3><a class='anchor' name='Ambisonic%20UHJ%20stereo'>Ambisonic UHJ stereo</a></h3>

<p><a href="http://en.wikipedia.org/wiki/Ambisonic_UHJ_format">Ambisonic UHJ</a> is the stereo format for Ambisonics.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A kernel type encoder, see <a href="./../Classes/FoaEncoderKernel.html#*newUHJ">FoaEncoderKernel: *newUHJ</a> for further details.</div><div class='warning'><span class='warninglabel'>WARNING:</span> Kernel encoders require special care. Allow the kernel time to load before attempting to use. Additionally, the kernel buffer should be freed through the use of <a href="./../Classes/FoaEncoderKernel.html#-free">FoaEncoderKernel: -free</a> after use.</div><textarea class='editor'>// ------------------------------------------------------------
// ambisonic uhj stereo encoder
// stereo soundfile read from disk


// define encoder matrix
~encoder = FoaEncoderKernel.newUHJ


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/uhj/Palestrina-O_Bone.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/uhj/Gabrieli-Canzon_Duodecimi.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/uhj/Cante_Flamenco-Alegrias.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/uhj/Waldteufel-The_Skaters.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free kernel &amp; buffer
~encoder.free
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>Christ Church Cathedral Choir, "Palestrina: O Bone Jesu, exaudi me," Ambisonic Sampler, NI 1417<li>The Wallace Collection, "Gabrieli: Canzon Duodecimi Toni a 10 (No 2)," Ambisonic Sampler, NI 1417<li>C. Lobato, J. del Gastor, &amp; P. del Gastor, "Alegrias," Ambisonic Sampler, NI 1417<li>The Gulbenkian Orchestra, "Waldteufel: The Skaters' Waltz," Ambisonic Sampler, NI 1417</ul>
</div><h2><a class='anchor' name='Tetrahedral,%20aka%20A-format'>Tetrahedral, aka A-format</a></h2>

<p>You may like to review the discussion on Gerzon's experimental <a href="./../Tutorials/ABCs-of-the-ATK.html#Tetrahedral%20Recording">tetrahedral recording</a>, along with the discussion of the <a href="./../Tutorials/ABCs-of-the-ATK.html#Spatial%20Domains">spatial domains</a>.<div class='note'><span class='notelabel'>NOTE:</span> The ATK views A-format as a uniform spherical soundfield decomposition, rather than as raw, uncorrected microphone feeds.</div><h3><a class='anchor' name='Diffuse%20field%20&%20Push'>Diffuse field &amp; Push</a></h3>

<p>Here we encode four channels of decorrelated <a href="./../Classes/PinkNoise.html">PinkNoise</a> as a decorrelated soundfield, resulting in a maximally diffuse soundfield. <a href="./../Classes/FoaPush.html">FoaPush</a> is used to "push" the soundfield so that it becomes a planewave (infinite distance, in an anechoic environment) arriving from some direction. This technique gives the opportunity to continuously modulate between a directional and a diffuse soundfield.
<p>The soundfield is controlled by <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a>, where <a href="./../Classes/MouseX.html">MouseX</a> specifies the incident azimuth angle (pi to -pi; left to right of display) and <a href="./../Classes/MouseY.html">MouseY</a> the <a href="./../Classes/FoaPush.html">FoaPush</a> angle (0 to pi/2; bottom to top of display). With the mouse at the bottom of the display, the soundfield remains omnidirectional. Placed at the top of the display, the soundfield becomes directional, and varying left/right position will vary the incident azimuth of the resulting planewave.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newAtoB">FoaEncoderMatrix: *newAtoB</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// A to B encoder
// decorrelated pink noise source


// define encoder matrix
~encoder = FoaEncoderMatrix.newAtoB

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels

(
{
    var sig;                // audio signal
    var angle, azim;            // angle and azimuth control


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // angle ---&gt; top         = push to plane wave
    //          bottom    = omni-directional
    angle = MouseY.kr(pi/2, 0);

    // azimuth -&gt; hard left     = back
    //          centre     = centre
    //          hard right     = back
    azim = MouseX.kr(pi, -pi);

    // ------------------------------------------------------------
    // test sig
    sig = -3.dbamp * PinkNoise.ar([1, 1, 1, 1]); // 4 channels decorrelated pink noise


    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);

    // ------------------------------------------------------------
    // transform
    sig = FoaTransform.ar(sig, 'push', angle, azim);



    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)
// ------------------------------------------------------------</textarea>
<h3><a class='anchor' name='Spaced%20microphones'>Spaced microphones</a></h3>

<p>This example is somewhat unconvential as regards the literature. Four microphones (omnis) are place around the performer in a tetrahedron. This is then matrixed into B-format.
<p>As the performer rotates and moves about, the image shifts through the sound-scene. In a compositional context, <a href="./../Classes/FoaPush.html">FoaPush</a> could be used to control the soundfield.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newAtoB">FoaEncoderMatrix: *newAtoB</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// A to B encoder
// A-format soundfile read from disk

// define encoder matrix
~encoder = FoaEncoderMatrix.newAtoB('flrd')   // for Thomas
~encoder = FoaEncoderMatrix.newAtoB('flr')    // for Cross


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/a-format/Thomas_Mackay.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/a-format/Cross_Tenor_Sax.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>Niall Thomas, "Rob Mackay: flute improvisations," [unpublished recording]<li>David Cross, "Tenor saxophone improvisations," [unpublished recording]</ul>
</div><h2><a class='anchor' name='2D%20&%203D%20surround'>2D &amp; 3D surround</a></h2>
<h3><a class='anchor' name='Octophonic'>Octophonic</a></h3>

<p>The pantophonic encoder may be used to transcode from one format to another. This example transcodes an octophonic recording to the decoder you've chosen.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newPanto">FoaEncoderMatrix: *newPanto</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// pantophonic (8-channel) encoder
// pantophonic (8-channel) soundfile read from disk


// define encoder matrix
~encoder = FoaEncoderMatrix.newPanto(8, 'flat')   // choose for Mackay
~encoder = FoaEncoderMatrix.newPanto(8, 'point')  // choose for Young


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/multichannel/Mackay-Augustines_Message.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/multichannel/Young-Allting_Runt.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>Robert Mackay, "Augustine's Message," [unpublished recording]<li>John Young, "Allting Runt Omkring," [unpublished recording]</ul>
</div><h3><a class='anchor' name='Dome'>Dome</a></h3>

<p>The directions encoder may be used to transcode from one format to another. This example transcodes a periphonic 12-channel recording to the decoder you've chosen.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newPanto">FoaEncoderMatrix: *newPanto</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// periphonic (12-channel) encoder


// define encoder matrix
~directions = [ [ 22.5, 0 ], [ -22.5, 0 ], [ 67.5, 0 ], [ -67.5, 0 ], [ 112.5, 0 ], [ -112.5, 0 ], [ 157.5, 0 ], [ -157.5, 0 ], [ 45, 45 ], [ -45, 45 ], [ -135, 45 ], [ 135, 45 ] ].degrad
~encoder = FoaEncoderMatrix.newDirections(~directions)


// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg

// and see!
~pv = PointView().directions_(~directions).front


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/multichannel/Wilson-Bose.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf) doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>Scott Wilson, "Böse," [unpublished recording]</ul>
</div><h2><a class='anchor' name='2D%20ZoomH2'>2D ZoomH2</a></h2>

<p>While no longer manufactured, the ATK includes an encoder for the <a href="https://en.wikipedia.org/wiki/Zoom_H2_Handy_Recorder">ZoomH2</a> handheld digital audio recorder.<div class='note'><span class='notelabel'>NOTE:</span> As a simple matrix encoder, no frequency dependent spatial domain correction is applied.</div><h3><a class='anchor' name='ZoomH2,%20forward'>ZoomH2, forward</a></h3>

<p>The <a href="http://www.zoom.co.jp/english/products/h2/">ZoomH2</a> is a convenient, portable handheld recorder. The device only records horizontal surround (pantophonic), so we don't get height.
<p>As a relatively inexpensive piece of equipment, the imaging of the <a href="http://www.zoom.co.jp/english/products/h2/">ZoomH2</a> isn't always as consistent as we'd prefer. To remedy, the Y gain is tweaked to widen the image, and <a href="./../Classes/FoaXformerMatrix.html#*newDominateX">dominance</a> is applied to stabilise the front.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newZoomH2">FoaEncoderMatrix: *newZoomH2</a> and <a href="./../Classes/FoaXformerMatrix.html#*newDominateX">FoaXformerMatrix: *newDominateX</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// zoomH2 encoder
// zoomH2 soundfile read from disk


// define encoder and xform matricies
~encoder = FoaEncoderMatrix.newZoomH2(k: 1.7378)
~xformer = FoaXformerMatrix.newDominateX(3.0)

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/zoomh2/Anderson-Waltz.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/zoomh2/Anderson-Steam.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/zoomh2/Anderson-Stape_Silver.wav")
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/zoomh2/Anderson-St_Peter_&amp;_St_Paul.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // xform
    sig = FoaXform.ar(sig, ~xformer);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>Joseph Anderson, "Pickering Steam Fair: Waltz," [unpublished recording]<li>Joseph Anderson, "Pickering Steam Fair: Engine," [unpublished recording]<li>Joseph Anderson, "Stape Silver Band: March," [unpublished recording]<li>Joseph Anderson, "St Peter &amp; St Paul," [unpublished recording]</ul>
</div><h3><a class='anchor' name='ZoomH2,%20reversed'>ZoomH2, reversed</a></h3>

<p>As described <a href="./../Classes/FoaEncoderMatrix.html#*newZoomH2">here</a>, the <a href="http://www.zoom.co.jp/english/products/h2/">ZoomH2</a> encoder reverses the labels for front and back of the <a href="http://www.zoom.co.jp/english/products/h2/">ZoomH2</a>. This is done to favour the use of the decoder as a roving, hand-held device, with the display facing the operator.
<p>If one wishes to respect the labelled orientation of the device as does <a href="http://www.radio.uqam.ca/ambisonic/comparative_recording.html">Courville</a> in the example below, we'll need to either adjust the <strong>angles</strong> argument or apply <a href="./../Classes/FoaXform.html#*newMirrorX">FoaXform: *newMirrorX</a>. For this example, we'll set <strong>angles</strong> = <code>[3/4*pi, pi/3]</code>, which are those specified in the <a href="http://www.zoom.co.jp/downloads/h2/manual/">ZoomH2 documentation</a>.
<p>As a relatively inexpensive piece of equipment, the imaging of the <a href="http://www.zoom.co.jp/english/products/h2/">ZoomH2</a> isn't always as consistent as we'd prefer. To remedy, the Y gain is tweaked to widen the image.
<p>If you haven't already choosen a <code>~decoder</code> and defined <code>~renderDecode</code>, do so <a href="#Choose%20a%20decoder">now</a>.<div class='note'><span class='notelabel'>NOTE:</span> A matrix type encoder, see <a href="./../Classes/FoaEncoderMatrix.html#*newZoomH2">FoaEncoderMatrix: *newZoomH2</a> for further details.</div><textarea class='editor'>// ------------------------------------------------------------
// zoomH2 encoder
// zoomH2 soundfile read from disk


// define encoder matrix
~encoder = FoaEncoderMatrix.newZoomH2([3/4*pi, pi/3], 1.7378)

// inspect
~encoder.kind
~encoder.numChannels
~encoder.dirChannels.raddeg


// read a whole sound into memory
// remember to free the buffer later!
// (boot the server, if you haven't!)
~sndbuf = Buffer.read(s, Atk.userSoundsDir ++ "/zoomh2/Courville-Dialogue.wav")


(
{
    var sig;                            // audio signal


    // display encoder and decoder
    "Ambisonic encoding via % encoder".format(~encoder.kind).postln;
    "Ambisonic decoding via % decoder".format(~decoder.kind).postln;

    // ------------------------------------------------------------
    // test sig
    sig = PlayBuf.ar(~sndbuf.numChannels, ~sndbuf, BufRateScale.kr(~sndbuf), doneAction:2);   // soundfile

    // ------------------------------------------------------------
    // encode
    sig = FoaEncode.ar(sig, ~encoder);


    // ------------------------------------------------------------
    // decode (via ~renderDecode)
    ~renderDecode.value(sig, ~decoder)

}.scope;
)

// free buffer
~sndbuf.free
// ------------------------------------------------------------</textarea>
<div class='note'><span class='notelabel'>NOTE:</span> <strong>Soundfile Credits</strong><ul>
<li>D. Courville, "Comparative Surround Recording," Ambisonic Studio | Comparative Surround Recording, 2007. [Online]. Available: <a href="http://www.radio.uqam.ca/ambisonic/comparative_recording.html">http://www.radio.uqam.ca/ambisonic/comparative_recording.html</a> [Accessed: 26-Jul-2011].</ul>
</div>
<p><div class='footnotes'>
<a class='anchor' name='footnote_1'/><div class='footnote'>[<a href='#footnote_org_1'>1</a>] - J.-M. Batke, "The B-Format Microphone Revised," presented at the Ambisonics Symposium 2009, Graz, 2009.</div><a class='anchor' name='footnote_2'/><div class='footnote'>[<a href='#footnote_org_2'>2</a>] - D. G. Malham and A. Myatt, "3-D Sound Spatialization using Ambisonic Techniques," Computer Music Journal, vol. 19, no. 4, pp. 58-70, 1995.</div><a class='anchor' name='footnote_3'/><div class='footnote'>[<a href='#footnote_org_3'>3</a>] - We don't advise using this approach for encoding monophonic sources. The technique illustrated <a href="#omnidirectional_encoder">here</a> is the idiomatic method. If one desires a similar use of the mouse, <a href="./../Classes/MouseX.html">MouseX</a> and <a href="./../Classes/MouseY.html">MouseY</a> can be mapped appropriately to <a href="./../Classes/FoaPush.html">FoaPush</a>'s <strong>angle</strong>, <strong>theta</strong>, and <strong>phi</strong> parameters.</div><a class='anchor' name='footnote_4'/><div class='footnote'>[<a href='#footnote_org_4'>4</a>] - See: <a href="http://en.wikipedia.org/wiki/Ambisonics#Super_stereo">http://en.wikipedia.org/wiki/Ambisonics#Super_stereo</a></div></div><div class='doclink'>helpfile source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/HelpSource/Guides/Encoding-FOA.schelp'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/HelpSource/Guides/Encoding-FOA.schelp</a><br>link::Guides/Encoding-FOA::<br></div></div><script src='./../editor.js' type='text/javascript'></script>
</body></html>