<!doctype html><html lang='en'><head><title>KDTree | SuperCollider 3.10.1-rc1 Help</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../editor.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../lib/jquery.min.js'></script>
<script src='./../lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'KDTree';
var scdoc_sc_version = '3.10.1-rc1';
</script>
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>KDTree:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc2'><a href='#Inherited%20class%20methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Inherited%20instance%20methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented%20instance%20methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-allNearest'>allNearest</a> </li>
<li class='toc3'><a href='#-asArray'>asArray</a> </li>
<li class='toc3'><a href='#-collect'>collect</a> </li>
<li class='toc3'><a href='#-do'>do</a> </li>
<li class='toc3'><a href='#-dumpTree'>dumpTree</a> </li>
<li class='toc3'><a href='#-find'>find</a> </li>
<li class='toc3'><a href='#-kNearest'>kNearest</a> </li>
<li class='toc3'><a href='#-kNearestToNode'>kNearestToNode</a> </li>
<li class='toc3'><a href='#-label'>label</a> </li>
<li class='toc3'><a href='#-leftChild'>leftChild</a> </li>
<li class='toc3'><a href='#-location'>location</a> </li>
<li class='toc3'><a href='#-max'>max</a> </li>
<li class='toc3'><a href='#-min'>min</a> </li>
<li class='toc3'><a href='#-nearest'>nearest</a> </li>
<li class='toc3'><a href='#-nearestToNode'>nearestToNode</a> </li>
<li class='toc3'><a href='#-parent'>parent</a> </li>
<li class='toc3'><a href='#-radiusSearch'>radiusSearch</a> </li>
<li class='toc3'><a href='#-recreate'>recreate</a> </li>
<li class='toc3'><a href='#-rectSearch'>rectSearch</a> </li>
<li class='toc3'><a href='#-rightChild'>rightChild</a> </li>
<li class='toc3'><a href='#-sibling'>sibling</a> </li>
<li class='toc3'><a href='#-size'>size</a> </li>
<li class='toc3'><a href='#-uniqueid'>uniqueid</a> </li>
</ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#Tests'>Tests</a></li>
<ul class='toc'></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Classes (extension)</span>
 | <span id='categories'><a href='./../Browse.html#Collections'>Collections</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Collections>Unordered'>Unordered</a></span>
</div><h1>KDTree<span id='superclasses'> : <a href="../Classes/Object.html">Object</a></span>
<div class='extension-indicator-ctr' title='This help file originates from a third-party quark or plugin for SuperCollider.'><img class='extension-indicator-icon' alt='Extension' src='./../images/plugin.png'><span class='extension-indicator-text'>Extension</span></div></h1>
<div id='summary'>kd-tree data structure for efficient spatial search</div>
</div>
<div class='subheader'>
<div id='filename'>Source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/KDTree/KDTree.sc' title='/home/stefan/.local/share/SuperCollider/downloaded-quarks/KDTree/KDTree.sc'>KDTree.sc</a></div></div>
<h2><a class='anchor' name='description'>Description</a></h2>

<p>A kd-tree is a data structure for storing points in a Euclidean space. It is not optimised for data that changes (insertions/deletions) but is very efficient at spatial queries such as nearest-neighbour search. See <a href="http://en.wikipedia.org/wiki/Kd_tree">http://en.wikipedia.org/wiki/Kd_tree</a>
<p>KDTree is initialised using an array of points - each of these points must be an array, each of the same size. If you want to store an item or label along with each point, you can add it as the last item of each point array, and set the lastIsLabel constructor argument to true (see examples below). The things that you can store as "labels" can be anything at all, but they should be things that can meaningfully be compared for equality. Numbers, symbols, strings, etc, are all fine.
<p>(Note: You typically create a KDTree using an Array of points, but the array and the ordering of elements is not stored. The asArray method will return an array of points stored in the tree but typically in a different order.)<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='method-code'><span class='method-prefix'>KDTree.</span><a class='method-name' name='*new' href='./../Overviews/Methods.html#new'>new</a>(<span class='argstr'>array</span>, <span class='argstr'>depth: 0</span>, <span class='argstr'>parent</span>, <span class='argstr'>lastIsLabel: false</span>, <span class='argstr'>uniqueid: 1</span>)</h3>
<div class='method'>
<p>Create a new KDTree from an array of data. See example code below.</div><h3><a class='anchor' name='Inherited%20class%20methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='Inherited%20instance%20methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented%20instance%20methods'>Undocumented instance methods</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-allNearest' href='./../Overviews/Methods.html#allNearest'>allNearest</a>(<span class='argstr'>bestDist: inf</span>, <span class='argstr'>incExact: true</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-asArray' href='./../Overviews/Methods.html#asArray'>asArray</a>(<span class='argstr'>incLabels: false</span>, <span class='argstr'>arr</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-collect' href='./../Overviews/Methods.html#collect'>collect</a>(<span class='argstr'>func</span>, <span class='argstr'>incDeleted: false</span>, <span class='argstr'>arraySoFar</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-do' href='./../Overviews/Methods.html#do'>do</a>(<span class='argstr'>func</span>, <span class='argstr'>incDeleted: false</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-dumpTree' href='./../Overviews/Methods.html#dumpTree'>dumpTree</a>(<span class='argstr'>maxDepth: inf</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-find' href='./../Overviews/Methods.html#find'>find</a>(<span class='argstr'>point</span>, <span class='argstr'>incDeleted: false</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-kNearest' href='./../Overviews/Methods.html#kNearest'>kNearest</a>(<span class='argstr'>point</span>, <span class='argstr'>k</span>, <span class='argstr'>nearestSoFar</span>, <span class='argstr'>bestDist: inf</span>, <span class='argstr'>incExact: true</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-kNearestToNode' href='./../Overviews/Methods.html#kNearestToNode'>kNearestToNode</a>(<span class='argstr'>k</span>, <span class='argstr'>nearestSoFar</span>, <span class='argstr'>bestDist: inf</span>, <span class='argstr'>incExact: true</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-label' href='./../Overviews/Methods.html#label'>label</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-leftChild' href='./../Overviews/Methods.html#leftChild'>leftChild</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-location' href='./../Overviews/Methods.html#location'>location</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-max' href='./../Overviews/Methods.html#max'>max</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-min' href='./../Overviews/Methods.html#min'>min</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-nearest' href='./../Overviews/Methods.html#nearest'>nearest</a>(<span class='argstr'>point</span>, <span class='argstr'>nearestSoFar</span>, <span class='argstr'>bestDist: inf</span>, <span class='argstr'>incExact: true</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-nearestToNode' href='./../Overviews/Methods.html#nearestToNode'>nearestToNode</a>(<span class='argstr'>nearestSoFar</span>, <span class='argstr'>bestDist: inf</span>, <span class='argstr'>incExact: true</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-parent' href='./../Overviews/Methods.html#parent'>parent</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-radiusSearch' href='./../Overviews/Methods.html#radiusSearch'>radiusSearch</a>(<span class='argstr'>point</span>, <span class='argstr'>radius: 1</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-recreate' href='./../Overviews/Methods.html#recreate'>recreate</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-rectSearch' href='./../Overviews/Methods.html#rectSearch'>rectSearch</a>(<span class='argstr'>lo</span>, <span class='argstr'>hi</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-rightChild' href='./../Overviews/Methods.html#rightChild'>rightChild</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-sibling' href='./../Overviews/Methods.html#sibling'>sibling</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-size' href='./../Overviews/Methods.html#size'>size</a>(<span class='argstr'>incDeleted: false</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-uniqueid' href='./../Overviews/Methods.html#uniqueid'>uniqueid</a></h3>
<h2><a class='anchor' name='examples'>Examples</a></h2>
<textarea class='editor'>// KDTree with no labels stored:
~tree = KDTree([[2,3], [5,4], [9,6], [4,7], [8,1], [7,2]]);
// Or create one with a "label" (an item) at each node:
~tree = KDTree([[2,3, \fred], [5,4, \yep], [9,6, \bonk], [4,7, \hat], [8,1, \smak], [7,2, \jexx]], lastIsLabel: true);
~tree.dumpTree;
~tree.asArray;
~tree.asArray(incLabels: true);
// Each KDTree node stores data in a leftChild, a rightChild, and a location
~tree.leftChild.asArray;
~tree.rightChild.asArray;
~tree.location;


///////// Searching ////////////

// The kd-tree structure means that large portions of the tree often don't need to be searched. 
// For large data (e.g. 100000 points) this gives a massive speed increase compared against 
// searching the corresponding array, even for ordinary exact-match search. 
// Also allows fast spatial searches which are very efficient even on medium-sized data.
// See benchmarks below.

// Simple exact-match search - returns the first matching node object if found, or nil otherwise.
~tree.find([5,9]); // Not found
~tree.find([5,4]).label; // Found

// Nearest neighbour search - returns only one node, although of course there could be a tie.
// What is actually returned is an array containing [node, distance]
~tree.nearest([3,3]);
~tree.nearest([3,3])[0].location;
~tree.nearest([7,6])[0].location;
~tree.nearest([6,6])[0].location;
// Let's map out the nearest symbol at every point in a grid
11.do({|y| 11.do({|x| format("%\t", ~tree.nearest([x, y])[0].label).post; });    "".postln; });""

// To find the nearest point to a point that's already in the tree (excluding self), call nearestToNode on the node in question:
// (again, what is actually returned is an array containing [node, distance])
~tree.location
~tree.nearestToNode
~tree.nearestToNode[0].location
~tree.leftChild.location
~tree.leftChild.nearestToNode[0].location
~tree.do{|node| "node: %\t nearest other: %".format(node.location, node.nearestToNode[0].location).postln};

// "All Nearest Neighbour" search - each point finds its neighbour.
// This returns an array of assocations of the form (node -&gt; [nearestneighbour, distance]).
// It should be possible to optimise this relative to lots of separate .nearest queries, but at present speed is only a little bit faster.
~tree.allNearest
~tree.allNearest.do({|res| "(% -&gt; %)".format(res.key.location, res.value[0].location).postln});

// Search within a rectangle (/hyperrectangle), defined by low and high co-ordinates
~tree.rectSearch([4,4], [8,8]).collect(_.location);
~tree.rectSearch([2,1], [8,4]).collect(_.location);
~tree.rectSearch([12,11], [18,41]).collect(_.location);

// Search within a circle (/hypersphere), defined by a point and a radius
~tree.radiusSearch([3,6], 2).collect(_.location);
~tree.radiusSearch([3,6], 3).collect(_.location);


////////// Other things ////////

// min and max are measured independently on each dimension.
// They aren't cached, but calculated when requested.
~tree.min;
~tree.max;
~tree.leftChild.min;
~tree.leftChild.max;

// .do and .collect are implemented to iterate the whole tree, evaluating func for every (non-deleted) node
~tree.do({|node| node.location[0].postln});
~tree.collect({|node| node.location[0]});

// Adding and removing are NOT RECOMMENDED, because the change doesn't generally result in a balanced tree. To balance the tree you have to re-create it from scratch from the flat array, which the .recreate method will do - however if you're happy to use an un-balanced tree you may add/delete/undelete data:
~tree.dumpTree;   // Orig tree
~tree.add([5,5]).dumpTree;   // Now with new element, but unbalanced
~tree = ~tree.recreate; // Recreates structure from scratch! Not recommended! But will be balanced.
~tree.dumpTree;   // Recreated, the order is quite different
~tree.find([5,5]);
~tree.delete([5,5]); // "delete" marks a node as deleted, without removing it
~tree.find([5,5]);
~tree.find([5,5], incDeleted: true);
~tree.dumpTree;
~tree.undelete([5,5]);
~tree.find([5,5]);
~tree.dumpTree;
~tree.delete([5,5]);
~tree = ~tree.recreate; // Recreates structure from scratch! Not recommended! But will be balanced.
~tree.dumpTree; // Deleted nodes are not included in the recreated version.

// The DIFFERENTIAL ENTROPY of the spatial distribution can be estimated from nearest-neighbour distances:
~tree.entropyNN;
// Let's generate trees based on known distributions and estimate the entropy:
// 2D uniform distrib has the MAXIMAL entropy of anything with the same range (here 0 to 1):
~tree = KDTree({[1.0.rand, 1.0.rand]}.dup(1000));
~tree.entropyNN;
// The following should have a lower entropy than the above:
KDTree({[1.0.linrand, 1.0.linrand]}.dup(1000)).entropyNN;
// Even lower entropy:
KDTree({[1.0.linrand.squared, 1.0.linrand.squared]}.dup(1000)).entropyNN;
// For a 1D uniform distribution ranging from zero to one, the true entropy is zero:
KDTree({[1.0.rand]}.dup(1000)).entropyNN;</textarea>
<h2><a class='anchor' name='Tests'>Tests</a></h2>

<p>For speed tests see KDTree_benchmarking. 
<p>For unit tests (for correctness) there is a Unit Test class TestKDTree - basically just run KDTree.test<div class='doclink'>helpfile source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/KDTree/HelpSource/Classes/KDTree.schelp'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/KDTree/HelpSource/Classes/KDTree.schelp</a><br>link::Classes/KDTree::<br></div></div><script src='./../editor.js' type='text/javascript'></script>
</body></html>