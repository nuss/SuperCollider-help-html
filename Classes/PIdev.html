<!doctype html><html lang='en'><head><title>PIdev | SuperCollider 3.10.4-rc1 Help</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../editor.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../lib/jquery.min.js'></script>
<script src='./../lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'PIdev';
var scdoc_sc_version = '3.10.4-rc1';
</script>
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>PIdev:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc2'><a href='#Inherited%20class%20methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Inherited%20instance%20methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented%20instance%20methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-embedInStream'>embedInStream</a> </li>
<li class='toc3'><a href='#-hiDev'>hiDev</a> </li>
<li class='toc3'><a href='#-length'>length</a> </li>
<li class='toc3'><a href='#-loDev'>loDev</a> </li>
<li class='toc3'><a href='#-lookBack'>lookBack</a> </li>
<li class='toc3'><a href='#-maxLookBack'>maxLookBack</a> </li>
<li class='toc3'><a href='#-pattern'>pattern</a> </li>
<li class='toc3'><a href='#-thr'>thr</a> </li>
</ul></ul><li class='toc1'><a href='#Examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#Ex.%201:%20Basic%20usage:%20random%20choice%20within%20region%20without%20repetitions'>Ex. 1: Basic usage: random choice within region without repetitions</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%202:%20Variable%20deviations%20and%20lookBack'>Ex. 2: Variable deviations and lookBack</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%203:%20Moving%20source%20signal'>Ex. 3: Moving source signal</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%204:%20Dynamic%20deviation%20range%20and%20lookBack'>Ex. 4: Dynamic deviation range and lookBack</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%205:%20Non-integer%20source'>Ex. 5: Non-integer source</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%206:%20Multichannel%20expansion'>Ex. 6: Multichannel expansion</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%207:%20Application%20to%20other%20params:%20rhythm'>Ex. 7: Application to other params: rhythm</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Ex.%208:%20Proof%20of%20concept'>Ex. 8: Proof of concept</a></li>
<ul class='toc'></ul></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Classes (extension)</span>
 | <span id='categories'><a href='./../Browse.html#Libraries'>Libraries</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>miSCellaneous'>miSCellaneous</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>miSCellaneous>Other patterns'>Other patterns</a> | <a href='./../Browse.html#Libraries'>Libraries</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>miSCellaneous'>miSCellaneous</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>miSCellaneous>Idev suite'>Idev suite</a></span>
</div><h1>PIdev<span id='superclasses'> : <a href="../Classes/Pattern.html">Pattern</a> : <a href="../Classes/AbstractFunction.html">AbstractFunction</a> : <a href="../Classes/Object.html">Object</a></span>
<div class='extension-indicator-ctr' title='This help file originates from a third-party quark or plugin for SuperCollider.'><img class='extension-indicator-icon' alt='Extension' src='./../images/plugin.png'><span class='extension-indicator-text'>Extension</span></div></h1>
<div id='summary'>pattern searching for numbers with integer distance from a source pattern, optionally avoiding repetitions within a span</div>
</div>
<div class='subheader'>
<div id='filename'>Source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/miSCellaneous_lib/Classes/Patterns/PIdev.sc' title='/home/stefan/.local/share/SuperCollider/downloaded-quarks/miSCellaneous_lib/Classes/Patterns/PIdev.sc'>PIdev.sc</a></div><div id='subclasses'>Subclasses: <a href="../Classes/PLIdev.html">PLIdev</a></div>
<div id='related'>See also: <a href="./../Overviews/miSCellaneous.html">miSCellaneous</a>, <a href="./../Guides/Introduction_to_miSCellaneous.html">Introduction to miSCellaneous</a>, <a href="./../Tutorials/Idev_suite.html">Idev suite</a>, <a href="./../Classes/PLIdev.html">PLIdev</a>, <a href="./../Classes/DIdev.html">DIdev</a></div>
</div>
<h2><a class='anchor' name='description'>Description</a></h2>

<p>DIdev / PIdef / PLIdev search for numbers with integer distance from a source signal / pattern up to a given deviation. Repetitions within a lookback span are avoided, DIdev / PIdef / PLIdev randomly choose from possible solutions. Intended for search within integer grids (pitches, indices etc.), however applications with non-integer sources are possible, see examples.<div class='note'><span class='notelabel'>NOTE:</span> It's the user's responsibility to pass a combination of deviation and lookback values that allows a possible choice, see examples.</div><div class='note'><span class='notelabel'>NOTE:</span> In contrast to DIdev, PIdev and PLIdev do *not* need to know maximum deviations (<strong>minLoDev</strong>, <strong>maxHiDev</strong>) beforehand. Thus the order of arguments is different (here <strong>loDev</strong> and <strong>hiDev</strong> before lookBack).</div><h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='method-code'><span class='method-prefix'>PIdev.</span><a class='method-name' name='*new' href='./../Overviews/Methods.html#new'>new</a>(<span class='argstr'>pattern</span>, <span class='argstr'>maxLookBack: 3</span>, <span class='argstr'>loDev: -3</span>, <span class='argstr'>hiDev: 3</span>, <span class='argstr'>lookBack</span>, <span class='argstr'>thr: 0.001</span>, <span class='argstr'>length: inf</span>)</h3>
<div class='method'>
<p>Creates a new PIdev object.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>pattern<td class='argumentdesc'>
<p>The source value pattern to start search from.<tr><td class='argumentname'>maxLookBack<td class='argumentdesc'>
<p>Integer, the maximum lookback span. Fixed, defaults to 3.<tr><td class='argumentname'>loDev<td class='argumentdesc'>
<p>Determines the current low deviation for the search. Defaults to -3.<tr><td class='argumentname'>hiDev<td class='argumentdesc'>
<p>Determines the current high deviation for the search. Defaults to 3.<tr><td class='argumentname'>lookBack<td class='argumentdesc'>
<p>Determines the current lookback span for avoiding repetitions. Can be modulated but must not exceed <strong>maxLookBack</strong>. If no value is passed, then <strong>maxLookBack</strong> is taken.<tr><td class='argumentname'>thr<td class='argumentdesc'>
<p>Threshold for equality comparison. Can be modulated, defaults to 1e-3.<tr><td class='argumentname'>length<td class='argumentdesc'>
<p>Number of repeats. Defaults to inf.</table></div><h3><a class='anchor' name='Inherited%20class%20methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='Inherited%20instance%20methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented%20instance%20methods'>Undocumented instance methods</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-embedInStream' href='./../Overviews/Methods.html#embedInStream'>embedInStream</a>(<span class='argstr'>inval</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-hiDev' href='./../Overviews/Methods.html#hiDev'>hiDev</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-hiDev' href='./../Overviews/Methods.html#hiDev'>hiDev</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-length' href='./../Overviews/Methods.html#length'>length</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-length' href='./../Overviews/Methods.html#length'>length</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-loDev' href='./../Overviews/Methods.html#loDev'>loDev</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-loDev' href='./../Overviews/Methods.html#loDev'>loDev</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-lookBack' href='./../Overviews/Methods.html#lookBack'>lookBack</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-lookBack' href='./../Overviews/Methods.html#lookBack'>lookBack</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-maxLookBack' href='./../Overviews/Methods.html#maxLookBack'>maxLookBack</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-maxLookBack' href='./../Overviews/Methods.html#maxLookBack'>maxLookBack</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-pattern' href='./../Overviews/Methods.html#pattern'>pattern</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-pattern' href='./../Overviews/Methods.html#pattern'>pattern</a> = value</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-thr' href='./../Overviews/Methods.html#thr'>thr</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-thr' href='./../Overviews/Methods.html#thr'>thr</a> = value</h3>
<h2><a class='anchor' name='Examples'>Examples</a></h2>
<textarea class='editor'>(
s = Server.local;
Server.default = s;
s.boot;
)</textarea>

<p><a class='anchor' name='Ex.1'>&nbsp;</a><h3><a class='anchor' name='Ex.%201:%20Basic%20usage:%20random%20choice%20within%20region%20without%20repetitions'>Ex. 1: Basic usage: random choice within region without repetitions</a></h3>
<textarea class='editor'>// constant source (72), max deviation +/- 3
// no repetition within 5 pitches

(
p = Pbind(
    \dur, 0.2,
    \midinote, PIdev(72, 5, -3, 3).trace(prefix: "midi "),
).play;
)

p.stop</textarea>

<p><a class='anchor' name='Ex.2'>&nbsp;</a><h3><a class='anchor' name='Ex.%202:%20Variable%20deviations%20and%20lookBack'>Ex. 2: Variable deviations and lookBack</a></h3>
<textarea class='editor'>(
~loDev = -6;
~hiDev = 5;
~lookBack = 2;

p = Pbind(
    \dur, 0.2,
    \midinote, PIdev(72, 11, Pfunc { ~loDev }, Pfunc { ~hiDev }, Pfunc { ~lookBack }).trace(prefix: "midi "),
).play;
)

// change on the fly
// as lookBack equals 2, this defines a fixed sequence (up or down anyway)

(
~loDev = -1;
~hiDev = 1;
)

// widen range

(
~loDev = -6;
~hiDev = 5;
)

// force a twelve-tone row

~lookBack = 11;


// contradictory input, lookBack 11 not possible within range, causes repetitions

(
~loDev = -3;
~hiDev = 2;
)

p.stop</textarea>

<p><a class='anchor' name='Ex.3'>&nbsp;</a><h3><a class='anchor' name='Ex.%203:%20Moving%20source%20signal'>Ex. 3: Moving source signal</a></h3>
<textarea class='editor'>(
~loDev = -1;
~hiDev = 1;
~lookBack = 2;

p = Pbind(
    \dur, 1/7,
    \midinote, PIdev(
        Pseg(Pseq([65, 90], inf), 5, \sin).round,
        11,
        Pfunc { ~loDev },
        Pfunc { ~hiDev },
        Pfunc { ~lookBack }
    ).trace(prefix: "midi "),
).play;
)

// widen range and increase lookBack

(
~loDev = -6;
~hiDev = 5;
~lookBack = 10;
)

p.stop</textarea>

<p><a class='anchor' name='Ex.4'>&nbsp;</a><h3><a class='anchor' name='Ex.%204:%20Dynamic%20deviation%20range%20and%20lookBack'>Ex. 4: Dynamic deviation range and lookBack</a></h3>
<textarea class='editor'>// lookBack and deviations coupled here
// maxLookBack must be large enough

(
~loDev = -1;
~hiDev = 1;
~lookBack = 2;


p = Pbind(
    \dur, 1/7,
    \midinote, PIdev(
        78,
        10,
        Pn(Plazy { ~loDev }),
        Pn(Plazy { ~hiDev }).trace(prefix: "absolute deviation "),
        Pn(Plazy { ~lookBack })
    ).trace(prefix: "midi ");
).play
)

// start parameter movement on the fly

(
~loDev = Pseg(Pseq([2, 5].neg, inf), 5, \sin);
~hiDev = Pseg(Pseq([2, 5], inf), 5, \sin).trace(prefix: "absolute deviation and lookBack ");
~lookBack = Pseg(Pseq([2, 5], inf), 5, \sin);
)

p.stop</textarea>

<p><a class='anchor' name='Ex.5'>&nbsp;</a><h3><a class='anchor' name='Ex.%205:%20Non-integer%20source'>Ex. 5: Non-integer source</a></h3>
<textarea class='editor'>(
~loDev = -6;
~hiDev = 5;
~lookBack = 3;
~thr = 1;

p = Pbind(
    \dur, 1/7,
    \midinote, PIdev(
        Pseg(Pseq([65, 90], inf), 5, \sin),
        5,
        Pfunc { ~loDev },
        Pfunc { ~hiDev },
        Pfunc { ~lookBack },
        Pfunc { ~thr }
    ).trace(prefix: "midi "),
).play;
)

// close floats can occur here
~thr = 0.01

// not here
~thr = 2

p.stop</textarea>

<p><a class='anchor' name='Ex.6'>&nbsp;</a><h3><a class='anchor' name='Ex.%206:%20Multichannel%20expansion'>Ex. 6: Multichannel expansion</a></h3>
<textarea class='editor'>// larger pitch range and lookBack in upper voice, 
// as with most patterns, no automatic array expansion of pattern arguments

(
p = Pbind(
    \dur, 1/7,
    \src, Pseg(Pseq([65, 85], inf), 5, \sin).round,
    \midinote, Ptuple([
        PIdev(Pkey(\src), 1, -1, 1),
        PIdev(Pkey(\src) + 8.5, 3, -5, 5)
    ]).trace(prefix: "midi "),
).play;
)

p.stop</textarea>

<p><a class='anchor' name='Ex.7'>&nbsp;</a><h3><a class='anchor' name='Ex.%207:%20Application%20to%20other%20params:%20rhythm'>Ex. 7: Application to other params: rhythm</a></h3>
<textarea class='editor'>// if we have indexed data of whatever, we can slide over it,
// groups of durations as items to be streamed by PIdev

(
~rhythmBase = [
    [1, 1],
    [2, 1, 1],
    [1, 1, 2]
].collect(_.normalizeSum);

~rhythms = ~rhythmBase *.x [1, 2];
~rhythmNum = ~rhythms.size;
~rhythms = ~rhythms.scramble;

SynthDef(\noise_grain, { |out = 0, freq = 400, att = 0.005, rel = 0.1, 
    rq = 0.05, pan = 0, amp = 0.1|
    var sig = { WhiteNoise.ar } ! 2;
    sig = BPF.ar(sig, freq, rq) *
        EnvGen.ar(Env.perc(att, rel, amp), doneAction: 2) *
        (rq ** -1) * (250 / (freq ** 0.8));
    OffsetOut.ar(out, Pan2.ar(sig, pan));
}).add;
)

(
// rhythmic variation and partial pitch repetition
// play for a while to note slow sliding caused by Pseg

~loDev = -1;
~hiDev = 1;

p = Pbind(
    \instrument, \noise_grain,
    \rel, Pexprand(0.05, 0.15),
    \dur, PIdev(
        // be careful not to exceed index bounds
        Pseg(Pseq([~loDev.abs, ~rhythmNum - ~hiDev - 1], inf), 10, \sin, inf).round, 
        2, // lookBack span, no repetition within 3 items
        ~loDev, 
        ~hiDev
    ).trace(prefix: "rhythm type: ").collect(~rhythms[_]).flatten * 0.3,
    \midinote, Pstutter(Pwhite(1, 2), Pclump(3, Pxrand((50..100), inf))).flatten + [0, 12],
    \pan, Pstutter(Pwhite(1, 2), Pclump(3, Pwhite(-1.0, 1))).flatten
).play;
)

p.stop</textarea>

<p><a class='anchor' name='Ex.8'>&nbsp;</a><h3><a class='anchor' name='Ex.%208:%20Proof%20of%20concept'>Ex. 8: Proof of concept</a></h3>
<textarea class='editor'>(
// Function to check an array for repetitions within a maximum test span

~repetitionCheck = { |array, maxTestSpan|
    maxTestSpan.do { |i|
        var result = (array.drop(i+1) - array).drop((i+1).neg).includes(0).not;
        ("no repetitions within a span of " ++ (i+2).asString ++ " items: ").post;
        result.postln;
    }
}
)

// test case
// no repetitions within a maximum span of 6 (lookBack == 5)

(
p = PIdev(Pbrown(0, 20, 0.3).round.asInteger, 5, -7, 7).iter;
a = p.nextN(10000);
a.plot;
~repetitionCheck.(a, 10);
)</textarea>
<div class='doclink'>helpfile source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/miSCellaneous_lib/HelpSource/Classes/PIdev.schelp'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/miSCellaneous_lib/HelpSource/Classes/PIdev.schelp</a><br>link::Classes/PIdev::<br></div></div><script src='./../editor.js' type='text/javascript'></script>
</body></html>