<!doctype html><html lang='en'><head><title>HoaNFCtrl | SuperCollider 3.11.2 Help</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../editor.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../lib/jquery.min.js'></script>
<script src='./../lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'HoaNFCtrl';
var scdoc_sc_version = '3.11.2';
</script>
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>HoaNFCtrl:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*ar'>ar</a> </li>
<li class='toc2'><a href='#Inherited%20class%20methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc2'><a href='#Inherited%20instance%20methods'>Inherited instance methods</a></li>
</ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'><li class='toc2'><a href='#HOA%20with%20NFE%20decoding'>HOA with NFE decoding</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#HOA%20with%20NFE%20encoding'>HOA with NFE encoding</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#HOA%20with%20NFE%20imaging'>HOA with NFE imaging</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Radial%20modulation'>Radial modulation</a></li>
<ul class='toc'></ul></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Classes (extension)</span>
 | <span id='categories'><a href='./../Browse.html#Libraries'>Libraries</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit'>Ambisonic Toolkit</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit>UGens'>UGens</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit>UGens>HOA'>HOA</a>&#8201;&gt;&#8201;<a href='./../Browse.html#Libraries>Ambisonic Toolkit>UGens>HOA>Transformer'>Transformer</a> | <a href='./../Browse.html#UGens'>UGens</a>&#8201;&gt;&#8201;<a href='./../Browse.html#UGens>Multichannel'>Multichannel</a>&#8201;&gt;&#8201;<a href='./../Browse.html#UGens>Multichannel>Ambisonics'>Ambisonics</a></span>
</div><h1>HoaNFCtrl<span id='superclasses'> : <a href="../Classes/HoaUGen.html">HoaUGen</a> : <a href="../Classes/Object.html">Object</a></span>
<div class='extension-indicator-ctr' title='This help file originates from a third-party quark or plugin for SuperCollider.'><img class='extension-indicator-icon' alt='Extension' src='./../images/plugin.png'><span class='extension-indicator-text'>Extension</span></div></h1>
<div id='summary'>Higher Order Ambisonic (HOA) NFE control transformer</div>
</div>
<div class='subheader'>
<div id='filename'>Source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/Classes/HoaUGen.sc' title='/home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/Classes/HoaUGen.sc'>HoaUGen.sc</a></div><div id='related'>See also: <a href="./../Classes/HoaNFDist.html">HoaNFDist</a>, <a href="./../Classes/HoaNFProx.html">HoaNFProx</a>, <a href="./../Classes/DegreeDist.html">DegreeDist</a>, <a href="./../Classes/DegreeProx.html">DegreeProx</a>, <a href="./../Classes/DegreeCtrl.html">DegreeCtrl</a></div>
</div>
<h2><a class='anchor' name='description'>Description</a></h2>

<p>Higher Order Ambisonic signal (HOA) near-field effect (NFE) control transformer.<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='method-code'><span class='method-prefix'>HoaNFCtrl.</span><a class='method-name' name='*ar' href='./../Overviews/Methods.html#ar'>ar</a>(<span class='argstr'>in</span>, <span class='argstr'>encRadius</span>, <span class='argstr'>decRadius</span>, <span class='argstr'>order</span>)</h3>
<div class='method'>
<p><h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>in<td class='argumentdesc'>
<p>The input signal.<tr><td class='argumentname'>encRadius<td class='argumentdesc'>
<p>The encoding radius in meters.<tr><td class='argumentname'>decRadius<td class='argumentdesc'>
<p>The decoding radius in meters.<tr><td class='argumentname'>order<td class='argumentdesc'>
<p>Ambisonic order.</table><h4>Discussion:</h4>

<p>Three use cases:<table>
<tr><td><strong>case</strong><td><strong>radial transform</strong><td><strong>encRadius</strong><td><strong>decRadius</strong><tr><td>NFE decoding<a class='footnote anchor' name='footnote_org_1' href='#footnote_1'><sup>1</sup></a> <td>decode NFE to basic<td><code>AtkHoa.refRadius</code><td>target decoding radius<tr><td>NFE encoding<td>encode NFE from basic<td>target encoding radius<td><code>AtkHoa.refRadius</code><tr><td>NFE imaging<td>translate source to target<td>target encoding radius<td>source encoding radius</table>

<p><a href="./../Classes/HoaNFCtrl.html">HoaNFCtrl</a> offers comprehensive control of the near-field effect (NFE) by combining <a href="./../Classes/HoaNFDist.html">HoaNFDist</a> and <a href="./../Classes/HoaNFProx.html">HoaNFProx</a> into a single, stable transform.
<p>This transform offers an HOA equivalent to <a href="./../Classes/FoaNFC.html">FoaNFC</a> followed by <a href="./../Classes/FoaProximity.html">FoaProximity</a>, in the first order case.</div><h3><a class='anchor' name='Inherited%20class%20methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3><a class='anchor' name='Inherited%20instance%20methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h2><a class='anchor' name='examples'>Examples</a></h2>
<h3><a class='anchor' name='HOA%20with%20NFE%20decoding'>HOA with NFE decoding</a></h3>

<p>Radial encoding followed by decoding with loudspeaker near-field compensation.<textarea class='editor'>// Inspect the ATK's speed of sound reference
"Speed of sound: % m/s".format(AtkHoa.speedOfSound);

// Inspect the ATK's reference radius
"Reference radius: % m".format(AtkHoa.refRadius);

// Inspect the ATK's channel/coefficient ordering
"Coefficient ordering: %".format(AtkHoa.ordering);

// Inspect the ATK's channel/coefficient ordering
"Coefficient normalisation: %".format(AtkHoa.normalisation);


// simple test...

// boot rt server
s.boot;

// choose Ambisonic order
~order = 1
~order = 2
~order = 3

// choose an outbus, if need be
~outbus = 0

// encoding angles
// azimuth &amp; elevation
~theta = 0.0;
~phi = 0.0;

// explicitly set encoding radius
// i.e., radius != AtkHoa.refRadius
~encRadius = 2.0;  // &gt; AtkHoa.refRadius
~encRadius = 1.5;  // = AtkHoa.refRadius
~encRadius = 1.0;  // &lt; AtkHoa.refRadius


// decoding - panto decoder
~numChans = 8;
~orientation = \flat;
~beamShape = \basic;
~beamShape = \energy;  // &lt;-- good choice!
~beamShape = \controlled;
~match = \amp;
~match = \rms;
~match = \energy;  // &lt;-- good choice!
~decRadius = 2.0;  // decoding / (actual) loudspeaker radius


// open scope
s.scope(~numChans, ~outbus);


// audition
(
{
    // saw params
    var freq = 110.0;
    var gain = -12;

    var sig;
    var hoa;

    sig = Saw.ar(freq, gain.dbamp);

    // encode with NFE
    hoa = HoaEncodeDirection.ar(sig, ~theta, ~phi, ~encRadius, ~order);

    // decode with NFE / loudspeaker near-field compensation
    HoaDecodeMatrix.ar(
        HoaNFCtrl.ar(  // NFE control
            hoa,
            AtkHoa.refRadius,
            ~decRadius,
            ~order
        ),
        HoaMatrixDecoder.newPanto(  // panto decoder
            ~numChans,
            ~orientation,
            ~beamShape,
            ~match,
            ~order
        )
    );

}.play(outbus: ~outbus)
)

// quit rt server
s.quit</textarea>
<h3><a class='anchor' name='HOA%20with%20NFE%20encoding'>HOA with NFE encoding</a></h3>

<p>Synthesise diffuse field at an encoding radius.<textarea class='editor'>// Inspect the ATK's speed of sound reference
"Speed of sound: % m/s".format(AtkHoa.speedOfSound);

// Inspect the ATK's reference radius
"Reference radius: % m".format(AtkHoa.refRadius);

// Inspect the ATK's channel/coefficient ordering
"Coefficient ordering: %".format(AtkHoa.ordering);

// Inspect the ATK's channel/coefficient ordering
"Coefficient normalisation: %".format(AtkHoa.normalisation);


// simple test...

// boot rt server
s.boot;

// choose Ambisonic order
~order = 1
~order = 2
~order = 3

// choose an outbus, if need be
~outbus = 0

// open scope
s.scope(~order.asHoaOrder.size, ~outbus);


// explicitly set encoding radius
// i.e., radius != AtkHoa.refRadius
~encRadius = 10.0;  // &gt;&gt; AtkHoa.refRadius
~encRadius = 5.0;  // &gt; AtkHoa.refRadius
~encRadius = 2.0;  // &gt; AtkHoa.refRadius
~encRadius = 1.5;  // = AtkHoa.refRadius
~encRadius = 1.0;  // &lt; AtkHoa.refRadius


// audition
(
{
    // params
    var gain = -12;

    var hoa;

    // diffuse field (synthesized at AtkHoa.refRadius)
    hoa = ~order.asHoaOrder.size.collect({ BrownNoise.ar(gain.dbamp) });

    // encode with NFE
    HoaNFCtrl.ar(  // NFE control
        hoa,
        ~encRadius,
        AtkHoa.refRadius,
        ~order
    );

}.play(outbus: ~outbus)
)

// quit rt server
s.quit</textarea>
<h3><a class='anchor' name='HOA%20with%20NFE%20imaging'>HOA with NFE imaging</a></h3>

<p>Translate from source radius to target radius.<textarea class='editor'>// Inspect the ATK's speed of sound reference
"Speed of sound: % m/s".format(AtkHoa.speedOfSound);

// Inspect the ATK's reference radius
"Reference radius: % m".format(AtkHoa.refRadius);

// Inspect the ATK's channel/coefficient ordering
"Coefficient ordering: %".format(AtkHoa.ordering);

// Inspect the ATK's channel/coefficient ordering
"Coefficient normalisation: %".format(AtkHoa.normalisation);


// simple test...

// boot rt server
s.boot;

// choose Ambisonic order
~order = 1
~order = 2
~order = 3

// choose an outbus, if need be
~outbus = 0

// open scope
s.scope(~order.asHoaOrder.size, ~outbus);


// encoding angles
// azimuth &amp; elevation
~theta = 0.0;
~phi = 0.0;

// explicitly set (source) encoding radius
// i.e., radius != AtkHoa.refRadius
~encRadius = 2.0;  // &gt; AtkHoa.refRadius
~encRadius = 1.5;  // = AtkHoa.refRadius
~encRadius = 1.0;  // &lt; AtkHoa.refRadius

// target (translation) radius
~reEncRadius = 3.0;  // re-encoding radius &gt; AtkHoa.refRadius
~reEncRadius = 1.5;  // re-encoding radius = AtkHoa.refRadius
~reEncRadius = 1.0;  // re-encoding radius &lt; AtkHoa.refRadius


// audition
(
{
    // saw params
    var freq = 110.0;
    var gain = -12;

    var sig;
    var hoa;

    sig = Saw.ar(freq, gain.dbamp);

    // encode with NFE
    hoa = HoaEncodeDirection.ar(sig, ~theta, ~phi, ~encRadius, ~order);

    // re-encode NFE
    HoaNFCtrl.ar(
        hoa,
        ~reEncRadius,
        ~encRadius,
        ~order
    );

}.play(outbus: ~outbus)
)

// quit rt server
s.quit</textarea>
<h3><a class='anchor' name='Radial%20modulation'>Radial modulation</a></h3>

<p>The use of two <a href="./../Classes/HoaNFCtrl.html">HoaNFCtrl</a> transformers offers the possibility of modulation at a given radius.<textarea class='editor'>// Inspect the ATK's speed of sound reference
"Speed of sound: % m/s".format(AtkHoa.speedOfSound);

// Inspect the ATK's reference radius
"Reference radius: % m".format(AtkHoa.refRadius);

// Inspect the ATK's channel/coefficient ordering
"Coefficient ordering: %".format(AtkHoa.ordering);

// Inspect the ATK's channel/coefficient ordering
"Coefficient normalisation: %".format(AtkHoa.normalisation);


// simple test...

// boot rt server
s.boot;

// choose Ambisonic order
~order = 1
~order = 2
~order = 3

// choose an outbus, if need be
~outbus = 0

// encoding angles
// azimuth &amp; elevation
~theta = 0.0;
~phi = 0.0;

// explicitly set encoding radius
// i.e., radius != AtkHoa.refRadius
~encRadius = 2.0;  // &gt; AtkHoa.refRadius
~encRadius = 1.5;  // = AtkHoa.refRadius
~encRadius = 1.0;  // &lt; AtkHoa.refRadius


// decoding / re-encoding - spherical design (A/B-format)
~numChans = 24;
~beamShape = \basic;
~beamShape = \energy;
~beamShape = \controlled;
~sphDesign = TDesign.newHoa(~numChans, order: ~order);


// modulation
~modRate = 20.0;
~modRate = 10.0;
~modRate = 5.0;


// open scope
s.scope(~order.asHoaOrder.size, ~outbus);


// audition
(
{
    // saw params
    var freq = 110.0;
    var gain = -12;

    var sig;
    var hoa;
    var aformat;

    sig = Saw.ar(freq, gain.dbamp);

    // encode with NFE
    hoa = HoaEncodeDirection.ar(sig, ~theta, ~phi, ~encRadius, ~order);

    // decode with NFE
    aformat = HoaDecodeMatrix.ar(
        HoaNFCtrl.ar(  // NFE control - decode at encoding radius, the "look" radius
            hoa,
            AtkHoa.refRadius,
            ~encRadius,
            ~order
        ),
        HoaMatrixDecoder.newSphericalDesign(  // a-format decoder
            ~sphDesign,
            ~beamShape,
            ~order
        )
    );

    // modulate amplitude of "virtual loudspeakers" - in a-format
    aformat = aformat * ~numChans.collect({ LFNoise2.ar(~modRate).range });
    // aformat = aformat * ~numChans.collect({ LFNoise2.ar(~modRate) });

    // re-encode with NFE
    HoaNFCtrl.ar(  // NFE control - re-encode at encoding radius, the "look" radius
        HoaEncodeMatrix.ar(
            aformat,
            HoaMatrixEncoder.newSphericalDesign(  // a-format encoder
                ~sphDesign,
                ~beamShape,
                ~order
            )
        ),
        ~encRadius,
        AtkHoa.refRadius,
        ~order
    );

}.play(outbus: ~outbus)
)

// quit rt server
s.quit</textarea>

<p><div class='footnotes'>
<a class='anchor' name='footnote_1'/><div class='footnote'>[<a href='#footnote_org_1'>1</a>] - Aka, NFE "looking".</div></div><div class='doclink'>helpfile source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/HelpSource/Classes/HoaNFCtrl.schelp'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/atk-sc3/HelpSource/Classes/HoaNFCtrl.schelp</a><br>link::Classes/HoaNFCtrl::<br></div></div><script src='./../editor.js' type='text/javascript'></script>
</body></html>