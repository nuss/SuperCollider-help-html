<!doctype html><html lang='en'><head><title>NPVoicer | SuperCollider 3.10.4 Help</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../codemirror.css' type='text/css' />
<link rel='stylesheet' href='./../editor.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../lib/jquery.min.js'></script>
<script src='./../lib/codemirror-5.39.2.min.js' type='text/javascript'></script>
<script src='./../lib/codemirror-addon-simple-5.39.2.min.js' type='text/javascript'></script>
<script>
var helpRoot = './..';
var scdoc_title = 'NPVoicer';
var scdoc_sc_version = '3.10.4';
</script>
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='qrc:///qtwebchannel/qwebchannel.js' type='text/javascript'></script>
</head>
<body onload='fixTOC()'>
<div id='toc'>
<div id='toctitle'>NPVoicer:</div>
<span class='toc_search'>Filter: <input id='toc_search'></span><ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc2'><a href='#Inherited%20class%20methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-prime'>prime</a> </li>
<li class='toc3'><a href='#-synCtl'>synCtl</a> </li>
<li class='toc3'><a href='#-indivParams'>indivParams</a> </li>
<li class='toc3'><a href='#-usesSpawn'>usesSpawn</a> </li>
<li class='toc3'><a href='#-put'>put</a> </li>
<li class='toc3'><a href='#-release'>release</a> </li>
<li class='toc3'><a href='#-playingKeys'>playingKeys</a> </li>
<li class='toc3'><a href='#-releaseAll'>releaseAll</a> </li>
<li class='toc3'><a href='#-spawn'>spawn</a> </li>
<li class='toc3'><a href='#-proxy'>proxy</a> </li>
<li class='toc3'><a href='#-play'>play</a> </li>
<li class='toc3'><a href='#-playN'>playN</a> </li>
<li class='toc3'><a href='#-pause'>pause</a> </li>
<li class='toc3'><a href='#-resume'>resume</a> </li>
<li class='toc3'><a href='#-stop'>stop</a> </li>
<li class='toc3'><a href='#-end'>end</a> </li>
<li class='toc3'><a href='#-set'>set</a> </li>
<li class='toc3'><a href='#-unset'>unset</a> </li>
<li class='toc3'><a href='#-map'>map</a> </li>
<li class='toc3'><a href='#-unmap'>unmap</a> </li>
<li class='toc3'><a href='#-setAt'>setAt</a> </li>
<li class='toc3'><a href='#-unsetAt'>unsetAt</a> </li>
<li class='toc2'><a href='#Inherited%20instance%20methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented%20instance%20methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-filterIndivPairs'>filterIndivPairs</a> </li>
<li class='toc3'><a href='#-hasGate'>hasGate</a> </li>
<li class='toc3'><a href='#-setUniAt'>setUniAt</a> </li>
<li class='toc3'><a href='#-synthDesc'>synthDesc</a> </li>
</ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'></ul></ul></div><div id='menubar'></div>
<div class='contents'>
<div class='header'>
<div id='label'>
<span id='folder'>Classes (extension)</span>
 | <span id='categories'><a href='./../Browse.html#Undocumented classes'>Undocumented classes</a></span>
</div><h1>NPVoicer<span id='superclasses'> : <a href="../Classes/Object.html">Object</a></span>
<div class='extension-indicator-ctr' title='This help file originates from a third-party quark or plugin for SuperCollider.'><img class='extension-indicator-icon' alt='Extension' src='./../images/plugin.png'><span class='extension-indicator-text'>Extension</span></div></h1>
<div id='summary'>handle polyphony with nodeproxies</div>
</div>
<div class='subheader'>
<div id='filename'>Source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/classes/NPVoicer/NPVoicer.sc' title='/home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/classes/NPVoicer/NPVoicer.sc'>NPVoicer.sc</a></div><div id='subclasses'>Subclasses: <a href="../Classes/NPVoicerL.html">NPVoicerL</a></div>
<div id='related'>See also: <a href="./../Overviews/JITLib.html">JITLib</a>, <a href="./../Classes/NodeProxy.html">NodeProxy</a>, <a href="./../Classes/Ndef.html">Ndef</a></div>
</div>
<h2><a class='anchor' name='description'>Description</a></h2>

<p>NPVoicer simplifies the use of polyphony in NodeProxies. One can flexibly play, access and release multiple voices of the same synth source with this wrapper around a nodeproxy.<textarea class='editor'>s.boot;
s.latency = nil;            // for immediate response;

g = NPVoicer(Ndef(\piano));     // make an NPVoicer with an Ndef in it
g.prime(\default);            // prepare it with the default synthdef

g.play;                    // play it

    // start a sound with key 48, with its won set of params
g.put(48, [\freq, 48.midicps]);

    // a second note at 51
g.put(51, [\freq, 51.midicps]);

    // release them
g.release(48);
g.release(51);

// test with MIDI if you have a controller around:
MIDIdef.noteOn(\pianOn, { |note, vel, chan|
    g.put(note, [\freq, note.midicps, amp: (vel/127).squared * 0.25 ]);
}, nil, 1);
MIDIdef.noteOff(\pianOff, { |note, vel, chan| g.release(note); }, nil, 1);</textarea>
<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='method-code'><span class='method-prefix'>NPVoicer.</span><a class='method-name' name='*new' href='./../Overviews/Methods.html#new'>new</a>(<span class='argstr'>proxy</span>, <span class='argstr'>indivParams</span>)</h3>
<div class='method'>
<p>make a new NPVoicer<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>proxy<td class='argumentdesc'>
<p>required - a nodeproxy to play voices in.<tr><td class='argumentname'>indivParams<td class='argumentdesc'>
<p>which params will be set for each new voice individually. this protects these params from accidental global setting.</table></div><h3><a class='anchor' name='Inherited%20class%20methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-prime' href='./../Overviews/Methods.html#prime'>prime</a>(<span class='argstr'>obj</span>, <span class='argstr'>useSpawn: false</span>)</h3>
<div class='method'>
<p>prepare proxy for playing voices.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>obj<td class='argumentdesc'>
<p>can be anything a nodeproxy accepts as source : a SynthDef, a Symbol (synthdef name), a function, ...<tr><td class='argumentname'>useSpawn<td class='argumentdesc'>
<p>a flag whether to put obj into slot 0. As voicers usually have individual voices and not a preferred front synth, default = false.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-synCtl' href='./../Overviews/Methods.html#synCtl'>synCtl</a></h3>
<div class='method'>
<p>internal - a SynthDefControl created when priming, and used for the voices.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-indivParams' href='./../Overviews/Methods.html#indivParams'>indivParams</a></h3>
<div class='method'>
<p>the list of param used individually and not globally.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-usesSpawn' href='./../Overviews/Methods.html#usesSpawn'>usesSpawn</a></h3>
<div class='method'>
<p>the flag whether a new nodeproxy object will play in slot 0 or not.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-put' href='./../Overviews/Methods.html#put'>put</a>(<span class='argstr'>key</span>, <span class='argstr'>args</span>)</h3>
<div class='method'>
<p>put a new voice into the objects list at<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>key<td class='argumentdesc'>
<p>at this key, typically a note number. (replaces a playing object there)<tr><td class='argumentname'>args<td class='argumentdesc'>
<p>with these starting individual arguments.</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-release' href='./../Overviews/Methods.html#release'>release</a>(<span class='argstr'>key</span>, <span class='argstr'>fadeTime</span>)</h3>
<div class='method'>
<p>release voice playing at key with given fadeTime.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-playingKeys' href='./../Overviews/Methods.html#playingKeys'>playingKeys</a></h3>
<div class='method'>
<p>return the keys of all currently playing voices.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-releaseAll' href='./../Overviews/Methods.html#releaseAll'>releaseAll</a>(<span class='argstr'>fadeTime</span>)</h3>
<div class='method'>
<p>return all currently playing voices withgiven fadetime.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-spawn' href='./../Overviews/Methods.html#spawn'>spawn</a>(<span class='argstr'>args</span>)</h3>
<div class='method'>
<p>if NPVoicer usesSpawn, spawn will create new voices that are only triggered and then take care of themselves, i.e. end automatically and do not allow control settings. see example.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>args<td class='argumentdesc'>
<p>args for the spawned voice.<tr><td class='argumentname'>(addAction)<td class='argumentdesc'>
<p>addAction for the spawned voice.
<p>/* Interfacing to nodeproxy */</table></div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-proxy' href='./../Overviews/Methods.html#proxy'>proxy</a></h3>
<div class='method'>
<p>the nodeproxy used to play the voices</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-play' href='./../Overviews/Methods.html#play'>play</a>(<span class='argstr'>out</span>, <span class='argstr'>numChannels</span>, <span class='argstr'>group</span>, <span class='argstr'>multi: false</span>, <span class='argstr'>vol</span>, <span class='argstr'>fadeTime</span>, <span class='argstr'>addAction</span>)</h3>
<div class='method'>
<p>play the nodeproxy. see NodeProxy:play for full info</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-playN' href='./../Overviews/Methods.html#playN'>playN</a>(<span class='argstr'>outs</span>, <span class='argstr'>amps</span>, <span class='argstr'>ins</span>, <span class='argstr'>vol</span>, <span class='argstr'>fadeTime</span>, <span class='argstr'>group</span>, <span class='argstr'>addAction</span>)</h3>
<div class='method'>
<p>playN the nodeproxy. see NodeProxy:playN for full info</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-pause' href='./../Overviews/Methods.html#pause'>pause</a></h3>
<div class='method'>
<p>pause the nodeproxy</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-resume' href='./../Overviews/Methods.html#resume'>resume</a></h3>
<div class='method'>
<p>resume the nodeproxy</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-stop' href='./../Overviews/Methods.html#stop'>stop</a>(<span class='argstr'>fadeTime: 0.1</span>, <span class='argstr'>reset: false</span>)</h3>
<div class='method'>
<p>stop the nodeproxy with fadeTime and reset options.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-end' href='./../Overviews/Methods.html#end'>end</a>(<span class='argstr'>fadeTime: 0.1</span>, <span class='argstr'>reset: false</span>)</h3>
<div class='method'>
<p>end the nodeproxy with fadeTime.</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-set' href='./../Overviews/Methods.html#set'>set</a>( <span class='argstr'>... args</span>)</h3>
<div class='method'>
<p>set global params of the nodeproxy. args are key value pairs to set, e.g. key1, val1, key2, val2, ... keyN, valN</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-unset' href='./../Overviews/Methods.html#unset'>unset</a>( <span class='argstr'>... keys</span>)</h3>
<div class='method'>
<p>unset global params of the nodeproxy. keys are the keys to unset, e.g. key1, key2, keyN</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-map' href='./../Overviews/Methods.html#map'>map</a>( <span class='argstr'>... args</span>)</h3>
<div class='method'>
<p>map global params of the nodeproxy. args are key value pairs to map, e.g. key1, val1, key2, val2, ... keyN, valN</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-unmap' href='./../Overviews/Methods.html#unmap'>unmap</a>( <span class='argstr'>... keys</span>)</h3>
<div class='method'>
<p>unmap global params of the nodeproxy. ... keys are the keys to unmap, e.g. key1, key2, keyN</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-setAt' href='./../Overviews/Methods.html#setAt'>setAt</a>(<span class='argstr'>key</span> <span class='argstr'>... args</span>)</h3>
<div class='method'>
<p>set and unset params at individual playing voices. key is the key of the voice to set params of; args are key value pairs to map, e.g. key1, val1, key2, val2, ... keyN, valN</div><h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-unsetAt' href='./../Overviews/Methods.html#unsetAt'>unsetAt</a>(<span class='argstr'>key</span> <span class='argstr'>... keys</span>)</h3>
<div class='method'>
<p>unset params at individual playing voices. key is the key of the voice to unset params of; keys are the keys to unset, e.g. key1, key2, keyN</div><h3><a class='anchor' name='Inherited%20instance%20methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented%20instance%20methods'>Undocumented instance methods</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-filterIndivPairs' href='./../Overviews/Methods.html#filterIndivPairs'>filterIndivPairs</a>(<span class='argstr'>argList</span>)</h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-hasGate' href='./../Overviews/Methods.html#hasGate'>hasGate</a></h3>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-setUniAt' href='./../Overviews/Methods.html#setUniAt'>setUniAt</a>(<span class='argstr'>index</span> <span class='argstr'>... args</span>)</h3>
<div class='extmethod'>From extension in <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/classes/extGetUni.sc'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/classes/extGetUni.sc</a></div>
<h3 class='method-code'><span class='method-prefix'>.</span><a class='method-name' name='-synthDesc' href='./../Overviews/Methods.html#synthDesc'>synthDesc</a></h3>
<h2><a class='anchor' name='examples'>Examples</a></h2>

<p>// ToDo - more examples - e.g.:<ul>
<li>with KeyPlayer<li>with MultiTouchPad<li>with NanoKey - MIDI, play and hold notes<li>NanoPad - MIDI, trigger perc notes only<li>with Manta controller<li>any others?</ul>
<textarea class='editor'>    // trigger percussion-style notes from computer keyboard while above window.
    // could also be done without NPVoicer, but it is convenient with NPVoicer.
(
s.latency = nil;
g = NPVoicer(Ndef(\x));
g.prime({ |freq = 400| SinOsc.ar(freq) * EnvGen.ar(Env.perc(0.001, 0.03, 0.4), doneAction:2) }, true);
g.play;

w = Window("ascii player - clickies").front;
w.view.keyDownAction = { |view, char|
    g.spawn([\freq, char.ascii.midicps])
};
)

    // play, hold, and release notes from computer keyboard
    // see also the KeyPlayer quark
(
s.latency = nil;
g = NPVoicer(Ndef(\x), [\freq]);
g.prime(\default, false);
g.play;

w = Window("ascii player2 - it IS a keyboard after all...").front;
w.view.keyDownAction = { |view, char|
    var key = char.ascii;
        // no retriggering
    if (g.playingKeys.includes(key).not) {
        g.put(key, [\freq, key.midicps])
    };
};
w.view.keyUpAction = { |view, char|
    var key = char.ascii;
    if (g.playingKeys.includes(key)) { g.release(key) };
};
)


// test setting and mapping global vs individual params:

g.play;
s.scope; // to see panning

// play a note
g.put(60, [\freq, 60.midicps]);

// global set - filters indivParams
g.indivParams;
// cannot set freq globally:
g.set(\freq, 62.midicps);
/// but we can set \amp and \pan
g.set(\amp, 0.0);
g.set(\amp, 0.2);
g.set(\pan, -1);
g.set(\pan, 1);

// set individual voice with setAt :
g.setAt(60, \amp, 0.0);
g.setAt(60, \amp, 0.1);
g.setAt(60, \pan, -1);
g.setAt(60, \pan, 1);
/ can set \freq on indiv. node:
g.setAt(60, \freq, 62.midicps);

// add a second note
g.put(79, [\freq, 79.midicps]);
// set indiv notes 60 to pan left/right
g.setAt(60, \pan, -1);
g.setAt(79, \pan, 1);

// check what is playing now
g.proxy.objects;
g.proxy.objects.indices;

// autopan
Ndef(\lfPan, { |lofreq = 0.3| SinOsc.kr(lofreq) * 2 });
// and map to global
g.map(\pan, Ndef(\lfPan));
// set indiv. afterwards unmaps them
g.setAt(60, \pan, -1);
g.setAt(79, \pan, 1);

// a new note still gets autopan
g.put(87, [\freq, 87.midicps]);
s.scope;

g.release(60);
g.release(79);

g.unmap(\pan);


// for comparison, test with a plain Ndef:

Ndef(\a, { |amp=0.1, pan| Pan2.ar(PinkNoise.ar(amp), pan) });
Ndef(\a).play;

Ndef(\a).set(\pan, 1);
Ndef(\a).set(\pan, -1);
Ndef(\a).map(\pan, Ndef(\lfPan));
Ndef(\a).unmap(\pan); // stops wherever lfo ended
Ndef(\a).unset(\pan); // unset to default

Ndef(\a).set(\pan, 1);
Ndef(\a).end;


// do post-processing on the proxy:
g.proxy.filter(150, { |in| (in * 10).distort * 0.2 });
g.play;
g.proxy.objects.indices
g.put(60, [\freq, 60.midicps]);
g.release(150);
g.release(60);

////////// Switch synthdefs while playing: ///////////

// make an alternate default synthdef with pulse
SynthDef(\defpulse, { arg out=0, freq=440, amp=0.1, pan=0, gate=1;
    var z;
    z = LPF.ar(
        Mix.new(Pulse.ar(freq + [0, Rand(-0.4,0.0), Rand(0.0,0.4)], 0.5, 0.3)),
        XLine.kr(Rand(4000,5000), Rand(2500,3200), 1)
    ) * Linen.kr(gate, 0.01, 0.7, 0.3, 2);
    OffsetOut.ar(out, Pan2.ar(z, pan, amp));
}, [\ir]).add;

// test new it
(instrument: \default).play;    // default cheap piano
(instrument: \defpulse).play;     // clarinetish square wave

v = NPVoicer(Ndef(\a).clear);
v.prime(\default); // use default synthdef
v.play;

// plays default sound with held arpeggio
Tdef(\a, {
    v.play;
    loop {
        3.do { |j|
        (0, 3 .. 21).do { |note|
            var midinote = note + 60 - j;
            v.put(midinote, [\freq, midinote.midicps]);
            defer ({ v.release(midinote) }, 2);
            0.25.wait;
        }
        };
    };
}).play;

// switch synthdef while playing
v.prime(\defpulse);
// and back
v.prime(\default);

Tdef(\a).stop;</textarea>

<p><div class='doclink'>helpfile source: <a href='file:///home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/HelpSource/Classes/NPVoicer.schelp'>/home/stefan/.local/share/SuperCollider/downloaded-quarks/JITLibExtensions/HelpSource/Classes/NPVoicer.schelp</a><br>link::Classes/NPVoicer::<br></div></div><script src='./../editor.js' type='text/javascript'></script>
</body></html>